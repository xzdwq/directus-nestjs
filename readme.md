### Требования
`Node`: `>=16.0.0`  
`NPM`: `>=7.0.0`  
`Lerna`: `npm i -g lerna`  

### Установка
Если установка из исходников, то удаляем зависимости: `npx lerna clean -y`  
1. Клонируем проект:  
    `git clone <url> -b <branch>`  
2. Инициализируем смежные директории проектов:  
    `lerna bootstrap`  
3. Устанавливаем зависимости:  
    `npm i`  
4. Собираем проект (необходимо т.к. некоторые модули работают только из сборки):  
    `npm run build`  
5. Инициализируем БД:  
    `npm run cli bootstrap`  
6. Заускаем миграции (предварительно необходимо переместить конфиг `.env` с подключениями к БД в корень, после миграций его можно удалить и оставить только в `api/`):  
    `npx directus database migrate:latest` - запуск последних актуальных миграций (только в случае если БД проинициализирована и с системными таблицами `directus_`).  
    `npx directus bootstrap` - инициализация БД директуса (только если ставим директус впервые на пустую БД).  


### Запуск для разработки
- Запуск без `lerna`, для разработки `api`, `app`, `nest-api`.  
Из корня проекта: `npm run go`  
Запустится `api`, `nest-api` и `app`, приложение будет доступно по адресу: `http://localhost:8080/`  

- Запуск через `lerna` - полный запуск всех модулей проекта (из под Windows через консоль и привычное Ctrl+C полная остановка процессов ноды поднятых через лерну невозможна, после оставки через консоль зайдите в Диспетчер задач -> Подробности, найдите все процессы ноды и остановите их)  

### Особенности
<details>
<summary> Исправления </summary>

1. Раздел `packages/schema`, который отвечает, в том числе, за идентификацию коллекций не только из схемы `public` в версии `9.8.0` (и даже в еще более ранней версии) перестал ожидаемым образом работать. Изначально ожидалось, что модуль будет брать переменную среды `DB_SEARCH_PATH="array:public,ib,pim"` и считывать указанные схемы, но он этого не делает и возвращает пустой набор. Для корректной работы с модулем из версии `9.8.0` необходимо удалить данную переменную или оставить одну единственную схему `public`, но тогда все остальные коллекции в схемах, помимо `public`, перестанут распознаваться как коллекции.  
Поэтому модуль `packages/schema` в версии `9.8.0` был заменен на такой же модуль из версии `9.0.0` (с некоторыми доработками) где подобных проблем не наблюдалось.  

2. В проект интегрирован UI Framework `Quasar`, который своими классами перебивает некоторые базовые классы проекта, поэтому был создан override классов для quasar. Расположение: `app/src/styles/quasar/override`. Для 2-й версии `Quasar` необходим `"sass": "1.32.11"` (в случае ошибок sass после обновления версии директуса необходимо понизить версию sass до указанной).  

3. В новых версиях `Directus` добавился редирект на `/admin/`, поэтому пришлось его убрать и добавить привычный `/api/` ко всем запросам обращения.  
Были затронуты:  
    - `app/vite.config.js` - изменено проксирование на `api`;  
    - `app/src/api.ts` - добавлен префикс `api/` в инстанс `axios`;  
    - `api/src/app.ts` - добавлен префикс `/api/` во всем `app.use('/api/url')`;  
    - `app/src/router.ts` - удален префикс `admin` в `history: createWebHistory(getRootPath())`;  
    - `app/src/utils/get-root-path.ts` - `return '/'`;  
    - `app/src/utils/get-root-path.ts` - добавлениа функция `getAssetsPath()`, которая возвращает путь до статики с препиской `api/` и найдены во всем проекте все обращения по пути `getRootPath() + assets/` и заенены на `getAssetsPath()`;  

</details>